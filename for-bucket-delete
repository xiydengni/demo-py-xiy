# import huaweicloudsdkobs.obs as obs
import obs

# 创建OBS客户端
access_key = 'xxxxx'
secret_key = 'xxxxx'
endpoint = 'https://obs.cn-north-4.myhuaweicloud.com'
bucket_name = 'xxxxxx-for-delete'

# 初始化客户端
obs_client = obs.ObsClient(
    access_key_id=access_key,
    secret_access_key=secret_key,
    server=endpoint
)

# 列出所有对象并批量删除
def delete_all_objects_in_bucket(bucket_name):
    try:
        # 分页列出桶内对象
        object_list = []
        response = obs_client.listObjects(bucket_name)
        while True:
            for content in response.body.contents:
                object_list.append({'Key': content.key})

            if response.body.is_truncated:  # 检查是否有更多对象
                response = obs_client.listObjects(bucket_name, marker=response.body.next_marker)
            else:
                break

        # 批量删除对象
        if object_list:
            delete_response = obs_client.deleteObjects(bucket_name, {'Objects': object_list})
            print(f"Deleted {len(object_list)} objects from {bucket_name}")
        else:
            print(f"No objects found in bucket {bucket_name}")

    except Exception as e:
        print(f"Error: {str(e)}")

# 调用删除函数
delete_all_objects_in_bucket(bucket_name)

# 关闭OBS客户端
obs_client.close()
